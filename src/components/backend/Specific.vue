<template>
  <section class="products">
    <!-- <h1>{{ msg }}</h1> -->
    <transition name="fall" mode="out-in">

      <loading v-if="loadingState" key="1" pic="loading" />

      <div v-else :key="2" class="products__container">

        <button @click="add()">
          <svg width="30px" x="0px" y="0px"
              viewBox="0 0 511.998 511.998" style="enable-background:new 0 0 511.998 511.998;" xml:space="preserve">
            <polygon style="fill:#51cbe9;" points="190.338,190.338 16.625,190.34 16.625,321.664 190.338,321.664 190.336,495.377 
              321.662,495.377 321.662,322.201 321.662,321.664 "/>
            <path style="fill:#235966;" d="M495.375,173.713H338.288V16.626c0-9.182-7.445-16.625-16.625-16.625H190.336
              c-9.18,0-16.625,7.443-16.625,16.625v157.087H16.625C7.445,173.713,0,181.156,0,190.338l0,0v131.324l0,0
              c0,0.557,0.028,1.111,0.085,1.659c0.04,0.399,0.108,0.79,0.176,1.18c0.025,0.143,0.037,0.289,0.066,0.432
              c0.093,0.465,0.214,0.921,0.344,1.372c0.02,0.066,0.032,0.135,0.052,0.201c0.138,0.456,0.303,0.899,0.479,1.338
              c0.025,0.063,0.043,0.128,0.07,0.191c0.171,0.409,0.366,0.806,0.567,1.199c0.047,0.091,0.085,0.185,0.133,0.274
              c0.186,0.347,0.396,0.682,0.607,1.012c0.08,0.128,0.151,0.261,0.234,0.387c0.191,0.286,0.404,0.554,0.612,0.826
              c0.121,0.16,0.233,0.328,0.361,0.482c0.206,0.251,0.434,0.484,0.653,0.723c0.145,0.156,0.278,0.323,0.431,0.474
              c0.153,0.153,0.321,0.288,0.479,0.434c0.238,0.219,0.469,0.444,0.718,0.65c0.158,0.13,0.328,0.243,0.49,0.366
              c0.269,0.206,0.537,0.417,0.82,0.607c0.131,0.088,0.269,0.161,0.402,0.244c0.328,0.206,0.655,0.412,0.996,0.597
              c0.101,0.055,0.208,0.096,0.309,0.15c0.381,0.195,0.765,0.384,1.162,0.549c0.083,0.035,0.171,0.06,0.254,0.093
              c0.417,0.166,0.838,0.324,1.272,0.456c0.103,0.032,0.211,0.052,0.314,0.081c0.414,0.118,0.831,0.231,1.257,0.316
              c0.213,0.043,0.432,0.065,0.647,0.098c0.321,0.052,0.638,0.111,0.966,0.145c0.552,0.055,1.109,0.085,1.667,0.085H173.71v157.089
              c0,9.182,7.445,16.625,16.625,16.625H321.66c9.18,0,16.625-7.443,16.625-16.625V321.664c0-0.557-0.028-1.111-0.083-1.659
              c-0.04-0.404-0.11-0.8-0.178-1.195c-0.025-0.138-0.037-0.279-0.063-0.417c-0.095-0.477-0.218-0.944-0.354-1.406
              c-0.017-0.055-0.027-0.111-0.042-0.165c-0.143-0.469-0.313-0.928-0.494-1.378c-0.02-0.05-0.035-0.101-0.055-0.15
              c-0.176-0.426-0.377-0.838-0.589-1.244c-0.038-0.075-0.07-0.155-0.11-0.229c-0.196-0.364-0.414-0.713-0.635-1.061
              c-0.071-0.111-0.133-0.229-0.206-0.339c-0.209-0.313-0.441-0.608-0.67-0.904c-0.103-0.133-0.195-0.273-0.303-0.404
              c-0.269-0.328-0.56-0.637-0.853-0.943c-0.081-0.085-0.151-0.176-0.234-0.259L206.961,183.454V33.251h98.076v157.087
              c0,9.182,7.445,16.625,16.625,16.625h157.087v98.076h-64.815c-9.18,0-16.625,7.443-16.625,16.625s7.445,16.625,16.625,16.625h81.44
              c9.18,0,16.625-7.443,16.625-16.625V190.338C512,181.156,504.555,173.713,495.375,173.713z M305.037,478.752h-98.076V321.664
              c0-0.557-0.028-1.111-0.083-1.659c-0.04-0.404-0.11-0.8-0.178-1.195c-0.025-0.138-0.037-0.279-0.063-0.417
              c-0.095-0.477-0.218-0.944-0.354-1.406c-0.017-0.055-0.027-0.111-0.043-0.165c-0.143-0.469-0.311-0.928-0.494-1.378
              c-0.02-0.05-0.035-0.101-0.055-0.15c-0.176-0.426-0.377-0.838-0.589-1.244c-0.038-0.075-0.07-0.155-0.11-0.229
              c-0.196-0.364-0.414-0.713-0.635-1.061c-0.071-0.111-0.133-0.229-0.206-0.339c-0.209-0.313-0.441-0.608-0.67-0.904
              c-0.103-0.133-0.195-0.273-0.303-0.404c-0.269-0.328-0.56-0.637-0.853-0.943c-0.081-0.085-0.151-0.176-0.234-0.259
              c-0.078-0.078-0.166-0.146-0.246-0.223c-0.311-0.298-0.623-0.592-0.956-0.865c-0.123-0.101-0.258-0.19-0.384-0.286
              c-0.304-0.236-0.607-0.472-0.926-0.685c-0.103-0.07-0.213-0.126-0.318-0.193c-0.354-0.226-0.712-0.449-1.082-0.647
              c-0.07-0.037-0.143-0.066-0.213-0.103c-0.411-0.213-0.828-0.416-1.258-0.595c-0.047-0.02-0.096-0.033-0.143-0.053
              c-0.452-0.183-0.913-0.352-1.385-0.495c-0.057-0.017-0.113-0.027-0.17-0.043c-0.461-0.135-0.926-0.258-1.401-0.352
              c-0.14-0.028-0.283-0.04-0.422-0.065c-0.394-0.068-0.788-0.138-1.19-0.178c-0.549-0.055-1.102-0.083-1.659-0.083H33.249V206.97
              h150.201l121.588,121.587v150.196H305.037z"/>
          </svg>
          Add
        </button>
        

        <ul class="products__list" >
          
          <li v-for="shoe in shoes" :key="shoe.id" 
              @click="selectShoe(shoe)"
              class="">
            <div class="products__list_item">
              <img :src="getJpgUrl(shoe.image)" alt="" class="products__logo">
              <h3>{{ shoe.title }}</h3>
              <h3 class="price">{{ shoe.price }} &euro;</h3>
            </div>
            <!-- <button type="submit" @click.prevent="remove(shoe)">
              Delete
            </button> -->
            <svg @click="remove(shoe)" width="30px" x="0px" y="0px"
                viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
              <polygon style="fill:#51cbe9;" points="14.713,197.889 14.713,314.11 198.365,314.11 314.584,197.889 "/>
              <path style="fill:#235966;" d="M497.287,183.176H314.584H14.713C6.587,183.176,0,189.763,0,197.889V314.11
                c0,8.126,6.587,14.713,14.713,14.713h183.652c0.48,0,0.959-0.025,1.436-0.071c0.122-0.012,0.24-0.037,0.36-0.052
                c0.356-0.044,0.712-0.09,1.065-0.159c0.104-0.021,0.205-0.053,0.307-0.075c0.366-0.081,0.731-0.166,1.092-0.275
                c0.072-0.022,0.14-0.052,0.212-0.074c0.385-0.124,0.769-0.255,1.146-0.41c0.046-0.019,0.09-0.044,0.135-0.063
                c0.394-0.168,0.783-0.347,1.164-0.55c0.046-0.024,0.087-0.053,0.132-0.078c0.372-0.205,0.742-0.419,1.099-0.658
                c0.106-0.071,0.203-0.152,0.306-0.225c0.288-0.203,0.578-0.406,0.855-0.633c0.378-0.309,0.743-0.639,1.092-0.986l111.912-111.912
                h161.897v86.796H335.938c-8.124,0-14.713,6.587-14.713,14.713s6.588,14.713,14.713,14.713h161.349
                c8.124,0,14.713-6.587,14.713-14.713V197.89C512,189.763,505.412,183.176,497.287,183.176z M29.425,212.601h249.64l-86.796,86.796
                H29.425V212.601z"/>
            </svg>
          </li>
        </ul>

        <a v-if="nextPage" 
            @click="loadMore" 
            class="load__more">
          show more shoes
          <svg width="40px" x="0px" y="0px"
              viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
            <polygon fill="#8AE9FF;" points="256,250.9 10.199,127.49 10.199,261.099 256,384.51 501.801,261.099 501.801,127.49 "/>
            <path fill="#248A9C;" d="M256,394.71c-1.569,0-3.136-0.361-4.576-1.084L5.623,270.215C2.175,268.485,0,264.958,0,261.1
              v-133.61c0-3.538,1.833-6.822,4.845-8.681c3.012-1.856,6.769-2.021,9.931-0.434L256,239.488l241.224-121.112
              c3.164-1.59,6.92-1.424,9.931,0.434c3.011,1.857,4.845,5.142,4.845,8.681V261.1c0,3.857-2.176,7.384-5.623,9.115l-245.801,123.41
              C259.136,394.348,257.569,394.71,256,394.71z M20.398,254.808L256,373.098l235.602-118.289V144.023L260.576,260.015
              c-2.879,1.446-6.273,1.446-9.153,0L20.398,144.023V254.808z"/>
            <path fill="#248A9C;" d="M414.097,275.562c-3.735,0-7.332-2.059-9.122-5.625c-2.528-5.034-0.496-11.164,4.538-13.691
              l6.455-3.241c5.037-2.526,11.164-0.496,13.691,4.538c2.528,5.034,0.496,11.164-4.538,13.691l-6.455,3.241
              C417.196,275.212,415.635,275.562,414.097,275.562z"/>
            <path fill="#248A9C;" d="M256.008,354.934c-3.735,0-7.332-2.059-9.123-5.625c-2.527-5.034-0.496-11.164,4.539-13.691
              l125.45-62.985c5.036-2.525,11.164-0.496,13.691,4.538c2.528,5.035,0.496,11.164-4.538,13.691l-125.45,62.985
              C259.108,354.586,257.546,354.934,256.008,354.934z"/>
          </svg>
        </a>

      </div>
    </transition>
  </section>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex';
  import Loading from '@/components/utils/Loading.vue';
  import loadingM from '../../mixins/loading';
  import imageUrl from '../../mixins/imageUrl';

  export default {
    name: 'Shoes',

    props: {
      msg: String
    },

    components: {
      Loading
    },

    mixins: [
      loadingM,
      imageUrl
    ],

    data() {
      return {
        shoes: [],
        currentPage: 0,
        lastPage: 0,
        nextPage: null
      }
    },

    computed: {
      ...mapGetters([ 'getAllShoes', 
                      'getCart' ]),
    },

    methods: {
      ...mapActions([ 'fetchShoes', 
                      'fetchNextShoes',
                      'fetchShoe',
                      'shoeDelete',
                      'shoeClear',
                      'setActiveComponent',
                      'fetchCart',
                      'updateCart' ]),
      
      async loadMore() {
        await this.fetchNextShoes(this.nextPage);
        this.shoes = this.shoes.concat(this.getAllShoes.data);
        this.setPage();
      },

      async selectShoe(item) {
        await this.fetchShoe(item);
        await this.setActiveComponent(true);
      },

      add() {
        this.setActiveComponent(true);
      },

      async remove(shoe) {
        await this.shoeDelete(shoe);
        this.shoeClear();
      },

      setPage() {
        this.currentPage = this.getAllShoes.current_page;
        this.lastPage = this.getAllShoes.last_page;
        this.nextPage = this.getAllShoes.next_page_url;
      }
    },

    async mounted() {
      await this.fetchShoes();
      this.shoes = this.getAllShoes.data;
      this.setPage();
      this.setLoadingState(false);
    },

    created() {
      this.setLoadingState(true);
    }
  }
</script>

<style lang="scss" scoped>
  .products__logo {
    width: 40px;
  }


  .products__list {
    display: grid;
    justify-content: center;
    grid-row-gap: 1em;

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      column-gap: 1em;
      padding: 1em;
      border-top: 1px solid $primary-turquoise;
      transition: all .3s ease-in-out;

      .products__list_item {
        display: flex;
        align-items: center;
        column-gap: .5em;
        cursor: pointer;

        img {
          transition: all .3s ease-in-out;
        }
      }

      svg {
        cursor: pointer;
      }
    }
    li:nth-child(even) {
      color: $primary-turquoise;
    }
    li:hover {
      color: $secondary-cyclamen;
      img {
        transform: scale(1.3);
      }
    }
  }

  
</style>