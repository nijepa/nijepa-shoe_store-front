<template>
  <div class="cart dropdown">

    <router-link to="/" @click.native="checkout()" class="cart__content">
      <h1 v-show="totalQty > 0">{{ totalQty }}</h1>

      <svg class="dropbtn" width="50px" x="0px" y="0px"
          viewBox="0 0 504 504" style="enable-background:new 0 0 504 504;" xml:space="preserve">
        <path class="svg_body" fill="transparent;" d="M485.617,114.305C484.125,112.828,482.102,112,480,112c-0.031,0-0.07,0-0.109,0l-374.5,4.941
          c-2.531,0.035-4.906,1.27-6.383,3.328c-1.484,2.059-1.898,4.699-1.125,7.113l62.5,195.059c1.063,3.313,4.141,5.559,7.617,5.559
          h280c22.055,0,40-17.945,40-40V120C488,117.859,487.141,115.809,485.617,114.305z M208,288c0,4.418-3.578,8-8,8s-8-3.582-8-8V168
          c0-4.418,3.578-8,8-8s8,3.582,8,8V288z M248,288c0,4.418-3.578,8-8,8s-8-3.582-8-8V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z
          M288,288c0,4.418-3.578,8-8,8s-8-3.582-8-8V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z M328,288c0,4.418-3.578,8-8,8s-8-3.582-8-8
          V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z M368,288c0,4.418-3.578,8-8,8s-8-3.582-8-8V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z
          M408,288c0,4.418-3.578,8-8,8s-8-3.582-8-8V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z M448,288c0,4.418-3.578,8-8,8s-8-3.582-8-8
          V168c0-4.418,3.578-8,8-8s8,3.582,8,8V288z"/>
        <circle fill=";" cx="144" cy="416" r="32"/>
        <circle fill="transparent;" cx="456" cy="416" r="32"/>
        <path fill="transparent;" d="M492,108H108c-0.316,0-0.614,0.069-0.924,0.093l-6.85-23.039C96.539,72.656,84.937,64,72.008,64
          L72,64.001V64H56v16h16v-0.001L72.008,80c5.898,0,11.195,3.953,12.875,9.613l73.242,246.348
          c3.032,10.188,8.988,18.919,16.632,25.696l-37.156,49.542c-2.656,3.535-1.938,8.551,1.602,11.199
          c1.438,1.082,3.117,1.602,4.789,1.602c2.438,0,4.836-1.105,6.406-3.199l37.713-50.286c7.295,3.45,15.317,5.485,23.693,5.485H448
          v40c0,4.418,3.578,8,8,8s8-3.582,8-8v-40h16c4.422,0,8-3.582,8-8s-3.578-8-8-8H211.805c-17.563,0-33.328-11.762-38.336-28.602
          L114.184,132H492c6.625,0,12-5.371,12-12S498.625,108,492,108z"/>
        <path fill="transparent;" d="M56,88H16C7.163,88,0,80.837,0,72v0c0-8.837,7.163-16,16-16h40c8.837,0,16,7.163,16,16v0
          C72,80.837,64.837,88,56,88z"/>
      </svg>
    </router-link>
    

    <ul class="dropdown-content">

      <router-link to="/" tag="button" 
                    @click.native="checkout()">
        Checkout
      </router-link>

      <shoes-list />
<!--       <li v-for="item in getCart" :key="item.id">
        <img :src="getJpgUrl(item.image)" alt="" class="shoe__small">
        <h3>{{ item.title }}</h3>

        <div class="item__qtu">

          <div class="qtu__arrows">
            <svg @click="updateQtu(item, 1)" width="20px" x="0px" y="0px"
                viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
              <path style="fill:#c8ddf8;" d="M490.761,326.438L277.894,136.493c-12.474-11.131-31.315-11.131-43.789,0L21.239,326.438
                c-22.539,20.112-8.313,57.421,21.895,57.421h425.732C499.074,383.86,513.299,346.55,490.761,326.438z"/>
              <g>
                <path style="fill: #2a64b1;" d="M468.866,394.06H43.134c-18.031,0-33.833-10.886-40.258-27.735
                  c-6.424-16.849-1.882-35.493,11.572-47.497l212.866-189.945c16.353-14.593,41.019-14.592,57.372-0.001l212.866,189.945l0,0
                  c13.453,12.005,17.996,30.649,11.572,47.497C502.699,383.174,486.897,394.06,468.866,394.06z M256,138.341
                  c-5.4,0-10.799,1.921-15.104,5.763L28.03,334.048c-8.599,7.671-8.784,17.95-6.093,25.009c2.693,7.06,9.674,14.603,21.196,14.603
                  h425.732c11.523,0,18.505-7.544,21.196-14.603c2.692-7.059,2.505-17.337-6.093-25.009L271.103,144.103
                  C266.8,140.263,261.399,138.341,256,138.341z"/>
                <path style="fill: #2a64b1;" d="M126.465,287.454c-2.806,0-5.6-1.151-7.615-3.409c-3.751-4.203-3.382-10.651,0.82-14.402l5.234-4.67
                  c4.206-3.75,10.653-3.381,14.402,0.82c3.751,4.203,3.382,10.651-0.82,14.402l-5.234,4.67
                  C131.307,286.6,128.881,287.454,126.465,287.454z"/>
                <path style="fill: #2a64b1;" d="M157.994,259.32c-2.806,0-5.599-1.151-7.614-3.409c-3.752-4.203-3.383-10.651,0.819-14.401
                  l96.307-85.937c4.205-3.753,10.652-3.382,14.401,0.819c3.752,4.203,3.383,10.651-0.819,14.401l-96.307,85.937
                  C162.836,258.466,160.41,259.32,157.994,259.32z"/>
              </g>
            </svg>
            <svg @click="updateQtu(item, 2)" width="20px" x="0px" y="0px"
                viewBox="0 0 512.001 512.001" style="enable-background:new 0 0 512.001 512.001;" xml:space="preserve">
              <path style="fill:#c8ddf8;" d="M21.239,185.56l212.867,189.945c12.474,11.131,31.315,11.131,43.789,0L490.761,185.56
                c22.539-20.112,8.313-57.421-21.895-57.421H43.134C12.927,128.138-1.3,165.449,21.239,185.56z"/>
              <g>
                <path style="fill: #2a64b1;" d="M256.001,394.061c-10.256,0-20.508-3.647-28.686-10.944L14.449,193.171
                  C0.995,181.166-3.548,162.522,2.876,145.674s22.227-27.735,40.258-27.735h425.732c18.031,0,33.833,10.886,40.258,27.735
                  c6.424,16.849,1.882,35.493-11.572,47.497L284.687,383.115C276.51,390.412,266.253,394.061,256.001,394.061z M28.031,177.951
                  l212.867,189.945c8.61,7.683,21.596,7.684,30.207-0.001L483.97,177.951c8.599-7.671,8.784-17.95,6.093-25.009
                  c-2.693-7.06-9.674-14.603-21.196-14.603H43.134c-11.523,0-18.505,7.544-21.196,14.602
                  C19.246,160.001,19.432,170.277,28.031,177.951z"/>
                <path style="fill: #2a64b1;" d="M380.31,249.613c-2.806,0-5.6-1.151-7.615-3.409c-3.751-4.203-3.382-10.651,0.82-14.402l5.234-4.67
                  c4.205-3.749,10.653-3.38,14.402,0.82c3.75,4.203,3.382,10.651-0.82,14.402l-5.234,4.67
                  C385.152,248.76,382.725,249.613,380.31,249.613z"/>
                <path style="fill: #2a64b1;" d="M257.706,359.015c-2.806,0-5.6-1.151-7.614-3.409c-3.751-4.203-3.383-10.651,0.82-14.401
                  l96.306-85.937c4.205-3.753,10.653-3.382,14.401,0.819c3.752,4.203,3.383,10.651-0.819,14.401l-96.307,85.937
                  C262.548,358.161,260.122,359.015,257.706,359.015z"/>
              </g>
            </svg>
          </div>

          <h3>{{ item.qtu + ' x ' + item.price + ' &euro;' }}</h3>
          <svg v-if="!hover"  @mouseover="hover = true"  
              class="del__btn" width="20px" x="0px" y="0px"
              viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
            <g>
              <polygon style="fill:#c8ddf8;" points="190.551,495.523 117.226,495.523 87.886,113.866 190.551,113.866 	"/>
              <polygon style="fill:#c8ddf8;" points="394.773,495.523 321.448,495.523 321.448,113.866 424.112,113.866 	"/>
            </g>
            <g>
              <path style="fill:#2a64b1;" d="M468.321,97.389h-44.208H321.446H190.551H87.888h-44.21c-9.1,0-16.477,7.378-16.477,16.477
                s7.377,16.477,16.477,16.477h28.95l28.168,366.444c0.661,8.585,7.818,15.213,16.429,15.213h73.325h51.333
                c9.1,0,16.477-7.378,16.477-16.477s-7.377-16.477-16.477-16.477H207.03V130.343h97.941v365.18c0,9.099,7.378,16.477,16.477,16.477
                h73.327c8.611,0,15.769-6.629,16.429-15.213l28.169-366.444h28.949c9.099,0,16.477-7.378,16.477-16.477
                S477.419,97.389,468.321,97.389z M174.074,479.046h-41.589L105.68,130.343h68.394V479.046L174.074,479.046z M379.513,479.046
                h-41.59V130.343h68.397L379.513,479.046z"/>
              <path style="fill:#2a64b1;" d="M332.693,75.578c-9.099,0-16.477-7.379-16.477-16.477V32.954H201.899V59.1
                c0,9.099-7.377,16.477-16.477,16.477s-16.477-7.379-16.477-16.477V16.477C168.944,7.378,176.321,0,185.421,0h147.272
                c9.099,0,16.477,7.378,16.477,16.477V59.1C349.17,68.201,341.794,75.578,332.693,75.578z"/>
            </g>
          </svg>
          <svg v-else @click="updateQtu(item, 0)" @mouseleave="hover = false" class="del__btn" 
              width="20px"  x="0px" y="0px" viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
            <path style="fill:#2a64b1;" d="M334.885,98.803c-1.182,0-2.381-0.142-3.579-0.439c-7.951-1.97-12.801-10.013-10.83-17.965
              l5.66-22.846l-99.892-24.752l-5.662,22.846c-1.97,7.951-10.021,12.801-17.965,10.83c-7.951-1.97-12.801-10.014-10.83-17.965
              l9.229-37.244c1.97-7.952,10.02-12.8,17.965-10.83L347.67,32.325c3.818,0.946,7.105,3.369,9.136,6.739
              c2.031,3.37,2.64,7.408,1.694,11.226l-9.229,37.245C347.597,94.288,341.542,98.803,334.885,98.803z"/>
            <g>
              <polygon style="fill:#c8ddf8;" points="177.957,497.166 111.947,497.166 85.536,153.586 177.957,153.586 	"/>
              <polygon style="fill:#c8ddf8;" points="361.805,497.166 295.795,497.166 295.795,153.586 388.217,153.586 	"/>
            </g>
            <path style="fill:#2a64b1;" d="M445.095,146.789L74.039,54.848c-7.945-1.971-15.995,2.876-17.965,10.83
              c-1.971,7.952,2.878,15.995,10.83,17.965l222.414,55.11h-111.36h-6.349H85.535c-4.131,0-8.075,1.724-10.883,4.754
              c-2.808,3.032-4.223,7.096-3.907,11.217l26.412,343.581c0.593,7.728,7.038,13.696,14.79,13.696h66.011h46.21
              c8.191,0,14.833-6.642,14.833-14.833c0-8.191-6.642-14.833-14.833-14.833h-31.377V168.419h88.169v328.747
              c0,8.191,6.642,14.833,14.833,14.833h66.01c7.752,0,14.196-5.967,14.79-13.696l25.491-331.609l35.874,8.89
              c1.199,0.297,2.397,0.439,3.579,0.439c6.657,0,12.712-4.515,14.385-11.269C457.897,156.802,453.048,148.759,445.095,146.789z
              M101.552,168.419h61.573v313.914h-37.442L101.552,168.419z M348.068,482.333h-37.439V168.419H372.2L348.068,482.333z"/>
          </svg>
        </div>

      </li> -->
      <!-- <h3>Total : {{ totalAmount }} &euro;</h3> -->
    </ul>
  </div>
</template>

<script>
  import { mapGetters, mapActions } from 'vuex';
  import { updateToken } from '../store/local_storage';
  import ShoesList from './ShoesList.vue';

  export default {
    name: 'Cart',

    components: {
      ShoesList
    },

    data() {
      return {
        hover: false,
      }
    },

    computed: {
      ...mapGetters([ 'getCart' ]),

      totalQty: function () {
        return this.getCart.reduce((a, {qtu}) => a + Number(qtu), 0);
      },

      /* totalAmount: function () {
        return this.getCart.reduce((a, {qtu, price}) => 
          Math.round(((a + (qtu * price)) + Number.EPSILON) * 100) / 100, 0);
      } */
    },

    methods: {
      ...mapActions([ 'fetchCart',
                      'initialState',
                      'enableCheckout',
                      'setLoadingState' ]),

      updateQtu(item, type) {
        this.fetchCart(updateToken(item, type));
      },

      checkout() {
        if (this.getCart.length) { 
          this.enableCheckout();
        }
      },

      getJpgUrl(pic) {
        return require('../assets/' + pic + '.jpg')
      },
    },

    async mounted() {
      await this.initialState();
    }
  }
</script>

<style lang="scss" scoped>
  .cart__content{
    svg {
      path, circle {
        transition: all .4s ease-in-out;
        fill: $primary-turquoise-dark;
      }
      .svg_body {
        transition: all .4s ease-in-out;
        fill: $secondary-cyclamen;
      }
    }
    h1 {
      transition: all .4s ease-in-out;
    }
  }
  .cart__content:hover {
    svg {
      path, circle {
        fill: $secondary-cyclamen;
      }
      .svg_body {
        fill: $primary-turquoise-dark;
      }
    }
    h1 {
      color: $primary-turquoise-dark;
      border: 1px solid $secondary-cyclamen;
    }
  }
</style>